<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="std::map with pointers as keys" /><meta name="author" content="Alexandra Zaharia" /><meta property="og:locale" content="en" /><meta name="description" content="When the keys in a std::map are pointers, find() will fail unless the search query is one of the actual pointers in the map. However, in most cases this might not be exactly what we want to achieve." /><meta property="og:description" content="When the keys in a std::map are pointers, find() will fail unless the search query is one of the actual pointers in the map. However, in most cases this might not be exactly what we want to achieve." /><link rel="canonical" href="https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" /><meta property="og:url" content="https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" /><meta property="og:site_name" content="Alexandra Zaharia" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-31T01:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="std::map with pointers as keys" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Alexandra Zaharia" /><meta name="google-site-verification" content="mlwABpnF22MCyeNCQoei9VdIPvqy_uV7b4v_vArTxXM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexandra Zaharia"},"dateModified":"2021-10-31T01:00:00+02:00","datePublished":"2021-10-31T01:00:00+02:00","description":"When the keys in a std::map are pointers, find() will fail unless the search query is one of the actual pointers in the map. However, in most cases this might not be exactly what we want to achieve.","headline":"std::map with pointers as keys","mainEntityOfPage":{"@type":"WebPage","@id":"https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/"},"url":"https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/"}</script><title>std::map with pointers as keys | Alexandra Zaharia</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alexandra Zaharia"><meta name="application-name" content="Alexandra Zaharia"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/site/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">Alexandra Zaharia</a>
</div>
<div class="site-subtitle font-italic">My dev blog</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
<li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/alexandra-zaharia" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/alexandra-zaharia-fr" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href%20=%20'mailto:'%20+%20['contact','alexandra-zaharia.org'].join('@')" aria-label="email"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss"> <i class="fas fa-rss"></i> </a>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>std::map with pointers as keys</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>std::map with pointers as keys</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="semi-bold"> Alexandra Zaharia </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 31, 2021, 1:00 AM +0200">Oct 31, 2021<i class="unloaded">2021-10-31T01:00:00+02:00</i> </span>
</div>
<div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="951 words">5 min read</span>
</div>
</div>
<div class="post-content">
<p>When the keys in a <code class="language-plaintext highlighter-rouge">std::map</code> are pointers, <code class="language-plaintext highlighter-rouge">find()</code> will fail unless the search query is one of the actual pointers in the map. However, in most cases this might not be exactly what we want to achieve.</p>
<p>Consider the following example: we want to map coordinates to planets at those coordinates using <code class="language-plaintext highlighter-rouge">std::map</code>. Here are the <code class="language-plaintext highlighter-rouge">Coords</code> and <code class="language-plaintext highlighter-rouge">Planet</code> classes:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td>
<td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">Coords</span> <span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">_x</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">_y</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">Coords</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">x</span><span class="p">,</span> <span class="kt">uint16_t</span> <span class="n">y</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">_x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">_y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coords</span><span class="o">&amp;</span> <span class="n">coords</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s">"("</span> <span class="o">&lt;&lt;</span> <span class="n">coords</span><span class="p">.</span><span class="n">_x</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span> <span class="o">&lt;&lt;</span> <span class="n">coords</span><span class="p">.</span><span class="n">_y</span> <span class="o">&lt;&lt;</span> <span class="s">")"</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Planet</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">Coords</span><span class="o">*</span> <span class="n">_coords</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">_name</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">Planet</span><span class="p">(</span><span class="k">const</span> <span class="n">Coords</span><span class="o">*</span> <span class="n">coords</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">_coords</span><span class="p">(</span><span class="n">coords</span><span class="p">),</span> <span class="n">_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">const</span> <span class="n">Coords</span><span class="o">*</span> <span class="n">get_coords</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_coords</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">Planet</span><span class="o">&amp;</span> <span class="n">planet</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="s">"Planet "</span> <span class="o">&lt;&lt;</span> <span class="n">planet</span><span class="p">.</span><span class="n">_name</span> <span class="o">&lt;&lt;</span> <span class="s">" @ "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">planet</span><span class="p">.</span><span class="n">_coords</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>Let’s create a map and add some coordinates and planets to it:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="n">Coords</span> <span class="n">c11</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
<span class="n">Coords</span> <span class="n">c22</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
<span class="n">Coords</span> <span class="n">c33</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
<span class="n">Coords</span> <span class="n">c44</span><span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>
<span class="n">Planet</span> <span class="n">proxima</span><span class="p">{</span><span class="o">&amp;</span><span class="n">c11</span><span class="p">,</span> <span class="s">"Proxima"</span><span class="p">};</span>
<span class="n">Planet</span> <span class="n">arrakis</span><span class="p">{</span><span class="o">&amp;</span><span class="n">c22</span><span class="p">,</span> <span class="s">"Arrakis"</span><span class="p">};</span>
<span class="n">Planet</span> <span class="n">remulak</span><span class="p">{</span><span class="o">&amp;</span><span class="n">c33</span><span class="p">,</span> <span class="s">"Remulak"</span><span class="p">};</span>
<span class="n">Planet</span> <span class="n">regulus</span><span class="p">{</span><span class="o">&amp;</span><span class="n">c44</span><span class="p">,</span> <span class="s">"Regulus"</span><span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="p">,</span> <span class="n">Planet</span> <span class="o">*&gt;</span> <span class="n">planet_map</span><span class="p">;</span>
<span class="n">planet_map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">proxima</span><span class="p">.</span><span class="n">get_coords</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">proxima</span><span class="p">));</span>
<span class="n">planet_map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">arrakis</span><span class="p">.</span><span class="n">get_coords</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">arrakis</span><span class="p">));</span>
<span class="n">planet_map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">remulak</span><span class="p">.</span><span class="n">get_coords</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">remulak</span><span class="p">));</span>
<span class="n">planet_map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">regulus</span><span class="p">.</span><span class="n">get_coords</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">regulus</span><span class="p">));</span>

<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>We obtain:</p>
<div class="language-plaintext highlighter-rouge">
<div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre>(1, 1): Planet Proxima @ (1, 1)
(2, 2): Planet Arrakis @ (2, 2)
(3, 3): Planet Remulak @ (3, 3)
(4, 4): Planet Regulus @ (4, 4)
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="the-problem">The problem</h2>
<p>We can also search for (<code class="language-plaintext highlighter-rouge">const Coords *</code>, <code class="language-plaintext highlighter-rouge">Planet *</code>) pairs <em>if we use one of the already existing</em> <code class="language-plaintext highlighter-rouge">Coords</code> objects:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c33</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Coordinates "</span> <span class="o">&lt;&lt;</span> <span class="n">query</span> <span class="o">&lt;&lt;</span> <span class="s">" are not present in the map"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>As expected, we obtain:</p>
<div class="language-plaintext highlighter-rouge">
<div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>(3, 3): Planet Remulak @ (3, 3)
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>But watch what happens if we use another object created through the default <code class="language-plaintext highlighter-rouge">Coords</code> copy constructor:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="n">Coords</span> <span class="n">query</span> <span class="o">=</span> <span class="n">c33</span><span class="p">;</span>
<span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="o">&amp;</span><span class="n">query</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">planet_map</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Coordinates "</span> <span class="o">&lt;&lt;</span> <span class="n">query</span> <span class="o">&lt;&lt;</span> <span class="s">" are not present in the map"</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="s">": "</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>This is the same code as above, except that now we declare a new <code class="language-plaintext highlighter-rouge">Coords</code> variable <code class="language-plaintext highlighter-rouge">query</code> to which we assign the <code class="language-plaintext highlighter-rouge">c33</code> variable. Internally, the assignment uses the <code class="language-plaintext highlighter-rouge">Coords</code> copy constructor <code class="language-plaintext highlighter-rouge">Coords(const Coords&amp; coords)</code>. In this case, the query is not found:</p>
<div class="language-plaintext highlighter-rouge">
<div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>Coordinates (3, 3) are not present in the map
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>This happens because, remember, the keys in the <code class="language-plaintext highlighter-rouge">std::map</code> are pointers to (<code class="language-plaintext highlighter-rouge">const</code>) <code class="language-plaintext highlighter-rouge">Coord</code> objects, and what <code class="language-plaintext highlighter-rouge">find()</code> does is try to match the pointers in the map against the pointer we pass to it (<code class="language-plaintext highlighter-rouge">&amp;query</code> in our example).</p>
<h2 id="the-solution">The solution</h2>
<p>We need a way to tell <code class="language-plaintext highlighter-rouge">find()</code> to compare the actual coordinates, and <em>not</em> the <code class="language-plaintext highlighter-rouge">Coords</code> pointers. There are two steps involved:</p>
<ol>
<li>We need to add custom logic to the coordinate comparison: in technical terms, we need to overload <code class="language-plaintext highlighter-rouge">operator&lt;</code> for the <code class="language-plaintext highlighter-rouge">Coords</code> class;</li>
<li>We need to create the <code class="language-plaintext highlighter-rouge">std::map</code> using a custom comparator. There are actually two ways to do this, we’ll get there in just a minute.</li>
</ol>
<h3 id="overload-the-less-than-operator">Overload the less-than operator</h3>
<p>Here we just need to define how two coordinates (<em>x<sub>1</sub></em>, <em>y<sub>1</sub></em>) and (<em>x<sub>2</sub></em>, <em>y<sub>2</sub></em>) are compared, returning <code class="language-plaintext highlighter-rouge">true</code> if (<em>x<sub>1</sub></em>, <em>y<sub>1</sub></em>) is less than (<em>x<sub>2</sub></em>, <em>y<sub>2</sub></em>) and <code class="language-plaintext highlighter-rouge">false</code> otherwise. In order to do this, we add the following member method to the <code class="language-plaintext highlighter-rouge">Coords</code> class:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Coords</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_x</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">_x</span><span class="p">)</span> <span class="k">return</span> <span class="n">_y</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">_y</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">_x</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">_x</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h3 id="custom-comparator-for-the-stdmap">Custom comparator for the std::map</h3>
<p>The comparator is the function object or predicate that gets to use our shiny new <code class="language-plaintext highlighter-rouge">operator&lt;</code> overload. As hinted here and as mentioned above, there are two ways to do this:</p>
<ol>
<li>We can use a function object, basically a <code class="language-plaintext highlighter-rouge">struct</code> with an overloaded <code class="language-plaintext highlighter-rouge">operator()</code>;</li>
<li>We can use a lambda expression.</li>
</ol>
<h4 id="using-a-function-object">Using a function object</h4>
<p>We can define a <code class="language-plaintext highlighter-rouge">struct CmpCoordsFunctor</code> overloading its <code class="language-plaintext highlighter-rouge">operator()</code>.</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">CmpCoordsFunctor</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">*</span><span class="n">lhs</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">rhs</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>A <em>functor</em> is simply a function object i.e. a class or struct that overloads <code class="language-plaintext highlighter-rouge">operator()</code>. When creating the <code class="language-plaintext highlighter-rouge">std::map</code>, we add <code class="language-plaintext highlighter-rouge">CmpCoordsFunctor</code> as comparator as follows:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="p">,</span> <span class="n">Planet</span> <span class="o">*</span><span class="p">,</span> <span class="n">CmpCoordsFunctor</span><span class="o">&gt;</span> <span class="n">planet_map</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h4 id="using-a-lambda-expression">Using a lambda expression</h4>
<p>Instead of using a functor as we’ve seen above, we can also use a lambda expression to achieve the same result:</p>
<div class="language-c++ highlighter-rouge">
<div class="code-header"> <span text-data=" C++ "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">auto</span> <span class="n">CmpCoordsLambda</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">*</span><span class="n">lhs</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">rhs</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Coords</span> <span class="o">*</span><span class="p">,</span> <span class="n">Planet</span> <span class="o">*</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">CmpCoordsLambda</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">planet_map</span><span class="p">(</span><span class="n">CmpCoordsLambda</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h3 id="the-end-result">The end result</h3>
<p>Regardless of the method used for adding the custom comparator (function object or lambda expression), the end result is the same. We can now search whether a given set of coordinates is present in the map by only examining the <em>value</em> of the coordinates, not the pointer itself. With the same <code class="language-plaintext highlighter-rouge">query</code> variable that was used at the beginning of this post, we now obtain the correct answer:</p>
<div class="language-plaintext highlighter-rouge">
<div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre>(3, 3): Planet Remulak @ (3, 3)
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>That’s it, happy planet mapping! <img class="emoji" title=":stars:" alt=":stars:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png" height="20" width="20"><img class="emoji" title=":telescope:" alt=":telescope:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f52d.png" height="20" width="20"></p>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/c-c/">C/C++</a>, <a href="/categories/pointers/">pointers</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c-c/" class="post-tag no-text-decoration">c/c++</a> <a href="/tags/pointers/" class="post-tag no-text-decoration">pointers</a> <a href="/tags/stl/" class="post-tag no-text-decoration">stl</a> <a href="/tags/map/" class="post-tag no-text-decoration">map</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=std::map%20with%20pointers%20as%20keys%20-%20Alexandra%20Zaharia&amp;url=https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=std::map%20with%20pointers%20as%20keys%20-%20Alexandra%20Zaharia&amp;u=https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=std::map%20with%20pointers%20as%20keys%20-%20Alexandra%20Zaharia&amp;url=https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=std::map%20with%20pointers%20as%20keys%20-%20Alexandra%20Zaharia&amp;u=https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
<div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2">
<li><a href="/posts/connect-bluetooth-headset-automatically-linux/">Connect a bluetooth headset automatically in Linux</a></li>
<li><a href="/posts/concurrency-crash-course-part-1/">Concurrency crash course. Part 1: Terminology, usage and pitfalls</a></li>
<li><a href="/posts/my-2021-dev-retrospective/">My 2021 dev retrospective</a></li>
<li><a href="/posts/how-to-stop-a-python-thread-cleanly/">How to stop a Python thread cleanly</a></li>
<li><a href="/posts/how-to-return-a-result-from-a-python-thread/">How to return a result from a Python thread</a></li>
</ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav>
</div>
</div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/const-and-pointers-in-cpp/"><div class="card-body"> <span class="timeago small">Oct 30, 2021<i class="unloaded">2021-10-30T01:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Const and pointers in C++</h3>
<div class="text-muted small"><p> The possible uses of the const qualifier with C++ pointers: pointer to const variable const pointer to variable const pointer to const variable All examples below will be using the same st...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/bitwise-nuggets-xor-swap/"><div class="card-body"> <span class="timeago small">Nov 2, 2021<i class="unloaded">2021-11-02T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bitwise nuggets: XOR swap</h3>
<div class="text-muted small"><p> XOR swap is a kind of in-place swap that only uses XOR operations. No temporary variable nor addition/subtraction operation is needed. However, it only works for integers. Reminder: XOR (short for...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/anonymous-unions-in-c/"><div class="card-body"> <span class="timeago small">Dec 17, 2017<i class="unloaded">2017-12-17T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Anonymous) unions in C</h3>
<div class="text-muted small"><p> The first time I had to explain to students why a C union may sometimes come in handy, I came up with this example. As my students had only been exposed to C for about 15 hours, I needed to refrain...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/const-and-pointers-in-cpp/" class="btn btn-outline-primary" prompt="Older"><p>Const and pointers in C++</p></a> <a href="/posts/bitwise-nuggets-xor-swap/" class="btn btn-outline-primary" prompt="Newer"><p>Bitwise nuggets: XOR swap</p></a>
</div>
<div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div>
<script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://alexandra-zaharia.github.io/posts/std-map-with-pointers-as-keys/'; this.page.identifier = '/posts/std-map-with-pointers-as-keys/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://azc.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script>
</div></div></div>
<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/alexandra-zaharia">Alexandra Zaharia</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Z7ZY7JRFQJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z7ZY7JRFQJ'); }); </script>
