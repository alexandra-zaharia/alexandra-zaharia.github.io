<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Multiprocessing in Python with shared resources" /><meta name="author" content="Alexandra Zaharia" /><meta property="og:locale" content="en" /><meta name="description" content="The problem" /><meta property="og:description" content="The problem" /><link rel="canonical" href="https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" /><meta property="og:url" content="https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" /><meta property="og:site_name" content="Alexandra Zaharia" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-04-17T02:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Multiprocessing in Python with shared resources" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Alexandra Zaharia" /><meta name="google-site-verification" content="mlwABpnF22MCyeNCQoei9VdIPvqy_uV7b4v_vArTxXM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexandra Zaharia"},"dateModified":"2021-12-30T19:03:14+01:00","datePublished":"2019-04-17T02:00:00+02:00","description":"The problem","headline":"Multiprocessing in Python with shared resources","mainEntityOfPage":{"@type":"WebPage","@id":"https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/"},"url":"https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/"}</script><title>Multiprocessing in Python with shared resources | Alexandra Zaharia</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alexandra Zaharia"><meta name="application-name" content="Alexandra Zaharia"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/site/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Alexandra Zaharia</a></div><div class="site-subtitle font-italic">My dev blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/alexandra-zaharia" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/alexandra-zaharia-fr" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['contact','alexandra-zaharia.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Multiprocessing in Python with shared resources</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Multiprocessing in Python with shared resources</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexandra Zaharia </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Apr 17, 2019, 2:00 AM +0200" >Apr 17, 2019<i class="unloaded">2019-04-17T02:00:00+02:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 30, 2021, 7:03 PM +0100" >Dec 30, 2021<i class="unloaded">2021-12-30T19:03:14+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1376 words">7 min read</span></div></div><div class="post-content"><h2 id="the-problem">The problem</h2><p>In the <a href="/posts/run-python-script-as-subprocess-with-multiprocessing/">previous post on parallelism in Python</a>, we have seen how an external Python script performing a long computation can be ran in parallel using Python’s <a href="https://docs.python.org/3/library/multiprocessing.html"><code class="language-plaintext highlighter-rouge">multiprocessing</code></a> module. If you haven’t done so already, take your time to read that post before this one.</p><p>Here we elaborate on the scenario presented in the previous post:</p><ul><li>As before, we have an external Python script <code class="language-plaintext highlighter-rouge">worker.py</code> that performs a long computation.<li>As before, <code class="language-plaintext highlighter-rouge">worker.py</code> is launched several times in parallel using a multiprocessing pool.<li>As before, the computations performed by the different worker instances are independent from each other.<li>Here comes the novelty: although the different computations are independent, they need to access (read and update) a <em>shared resource</em>.</ul><p>The figure below shows a shared resource (SR) in yellow, that needs to be accessed by the tasks in grey (arrows). Some tasks are ran in parallel on the four available CPUs.</p><p><img data-proofer-ignore data-src="/assets/img/posts/shared_resource.png" alt="shared resource" /></p><p>What we need to do is enable each task to access the shared resource <em>only if</em> no other task is currently accessing it. This can be achieved by using a synchronization mechanism called a <strong>lock</strong>.</p><h2 id="the-worker-script">The worker script</h2><p>First let us briefly see what is the task that we will be running in parallel. The <code class="language-plaintext highlighter-rouge">worker.py</code> script does just that, it performs a long “computation” (sleeping) and outputs a message at the end (for more explanations see the <a href="/posts/run-python-script-as-subprocess-with-multiprocessing/">previous post</a>):</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">time</span>


<span class="k">def</span> <span class="nf">do_work</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">I just did some hard work for {}s!</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
      <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Please provide one integer argument</span><span class="sh">'</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="p">.</span><span class="n">stderr</span><span class="p">)</span>
      <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">seconds</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="nf">do_work</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="the-main-script">The main script</h2><p>What we will be doing now is launching 100 processes in parallel on as many threads as we have CPUs. Each process launches <code class="language-plaintext highlighter-rouge">worker.py</code> as a Python <a href="https://docs.python.org/3/library/subprocess.html"><code class="language-plaintext highlighter-rouge">subprocess</code></a>. As we have seen above, the worker script sleeps for a given number of seconds.</p><h3 id="the-shared-resource">The shared resource</h3><p>Here is where the <strong>shared resource</strong> come into play. At the end of each “computation”, the worker process accesses this shared resource in both read and write mode. For the purpose of this example, let us imagine the shared resource is a list of results. The worker process needs to read the resource and update it with a certain value only if the value is not yet present in the list.</p><blockquote><p><strong>Note:</strong> The more observant may argue that a list updated only with values that are not already included in the list is the equivalent of a set. This is correct, however:</p><ul><li>the Python <code class="language-plaintext highlighter-rouge">multiprocessing</code> module only allows lists and dictionaries as shared resources, and<li>this is only an example meant to show that we need to reserve exclusive access to a resource in both read and write mode if what we write into the shared resource is dependent on what the shared resource already contains.</ul></blockquote><h3 id="the-script">The script</h3><p>Let us see the main script <code class="language-plaintext highlighter-rouge">main.py</code> right now and we’ll get into some details below:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>
<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">NUMBER_OF_TASKS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">progress_bar</span> <span class="o">=</span> <span class="nf">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">NUMBER_OF_TASKS</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">sec_sleep</span><span class="p">,</span> <span class="n">processed_values</span><span class="p">,</span> <span class="n">lock</span><span class="p">):</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">sec_sleep</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">python</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">worker.py</span><span class="sh">'</span><span class="p">,</span> <span class="nf">str</span><span class="p">(</span><span class="n">seconds</span><span class="p">)]</span>
    <span class="n">subprocess</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">seconds</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">processed_values</span><span class="p">:</span>
            <span class="n">processed_values</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">update_progress_bar</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="n">progress_bar</span><span class="p">.</span><span class="nf">update</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">NUMBER_OF_TASKS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Pool</span><span class="p">()</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Manager</span><span class="p">()</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nc">Lock</span><span class="p">()</span>
    <span class="n">shared_list</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="n">pool</span><span class="p">.</span><span class="nf">apply_async</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">shared_list</span><span class="p">,</span> <span class="n">lock</span><span class="p">,),</span>
                         <span class="n">callback</span><span class="o">=</span><span class="n">update_progress_bar</span><span class="p">)</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">shared_list</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="explanation">Explanation</h3><p>Just like in the <a href="/posts/run-python-script-as-subprocess-with-multiprocessing/">previous post</a>, we define a pool of tasks that we want to parallelize. Although the aim is to eventually run 100 processes (<code class="language-plaintext highlighter-rouge">NUMBER_OF_TASKS</code> is 100, see lines 5 and 23), we cannot effectively run them all at the same time. For true parallelism, each task should be handled by a separate CPU, and the tasks should be ran at the same time. This is why we define the pool of tasks as holding as many processes as there are CPU threads at line 24 (this is the default behavior for <code class="language-plaintext highlighter-rouge">mp.Pool()</code> with no argument). If you want to specify a different number of processes with respect to the available number of CPU threads you may use the <code class="language-plaintext highlighter-rouge">cpu_count()</code> method in the <code class="language-plaintext highlighter-rouge">multiprocessing</code> module or in the <code class="language-plaintext highlighter-rouge">os</code> module (for example, <code class="language-plaintext highlighter-rouge">mp.cpu_count() - 1</code>).</p><p>Once the multiprocessing pool is defined, we want to get stuff done. But before calling <code class="language-plaintext highlighter-rouge">apply_async()</code> on the pool’s processes, we first need to create both the shared resource that we’ve been talking about and the lock that will ensure that only one process may access the shared resource at a given time. Unlike in real life, if you want to get stuff done in Python’s <code class="language-plaintext highlighter-rouge">multiprocessing</code> module, you actually <em>do</em> need a <code class="language-plaintext highlighter-rouge">Manager</code>. We first create this manager, then use it to create the <code class="language-plaintext highlighter-rouge">lock</code> and the <code class="language-plaintext highlighter-rouge">shared_list</code> (lines 25-27).</p><p>In lines 29-31, we finally apply asynchronously the <code class="language-plaintext highlighter-rouge">work()</code> method to the pool of processes with the task at hand (<code class="language-plaintext highlighter-rouge">i</code>), the shared resource (<code class="language-plaintext highlighter-rouge">shared_list</code>) as well as the multiprocessing synchronization mechanism (<code class="language-plaintext highlighter-rouge">lock</code>). We use the callback <code class="language-plaintext highlighter-rouge">update_progress_bar()</code> in order to, well, update the <code class="language-plaintext highlighter-rouge">tqdm</code> progress bar.</p><p>Here is how the <code class="language-plaintext highlighter-rouge">work()</code> function handles the shared resource. It launches the external script <code class="language-plaintext highlighter-rouge">worker.py</code> using the Python <code class="language-plaintext highlighter-rouge">subprocess</code> module. The external script is ran with an argument representing the number of seconds (from 1 to 10) for which to run the long computation. Once the subprocess finishes, the <code class="language-plaintext highlighter-rouge">work()</code> method accesses the shared resource using the multiprocessing lock. In lines 13-15, the lock is acquired in order to ensure exclusive access to the shared list <code class="language-plaintext highlighter-rouge">processed_values</code>. Then if the number of seconds that the subprocess was called with is not already present in this list, we update the list with this value and we release the lock. Note that <code class="language-plaintext highlighter-rouge">with lock</code> is a shorthand notation for saying <em>“acquire the lock before doing something, then do something, and finally release the lock after doing something”</em>.</p><h2 id="parallelization-in-practice">Parallelization in practice</h2><p>Here is the output of our <code class="language-plaintext highlighter-rouge">main.py</code> script, truncated for brevity:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>$ python main.py
  0%|                                                        | 0/100 [00:00&lt;?, ?it/s]
I just did some hard work for 2s!
  1%|                                                        | 1/100 [00:02&lt;03:21,  2.04s/it]
I just did some hard work for 3s!
  2%|█                                                       | 2/100 [00:03&lt;02:49,  1.73s/it]
I just did some hard work for 4s!
  3%|█▊                                                      | 3/100 [00:04&lt;02:26,  1.51s/it]
I just did some hard work for 1s!
I just did some hard work for 5s!
  5%|██▌                                                     | 5/100 [00:05&lt;01:54,  1.21s/it]
I just did some hard work for 6s!
  6%|███▌                                                    | 6/100 [00:06&lt;01:47,  1.14s/it]
I just did some hard work for 2s!
I just did some hard work for 7s!
  8%|████▎                                                   | 8/100 [00:07&lt;01:27,  1.05it/s]
I just did some hard work for 3s!
I just did some hard work for 8s!
 10%|██████                                                 | 10/100 [00:08&lt;01:13,  1.23it/s]
[snip]
 99%|██████████████████████████████████████████████████████ | 99/100 [01:12&lt;00:01,  1.24s/it]
I just did some hard work for 10s!
100%|██████████████████████████████████████████████████████| 100/100 [01:14&lt;00:00,  1.46s/it]
[2, 3, 4, 1, 5, 6, 7, 8, 9, 10]
</pre></table></code></div></div><p>Notice how several worker processes that have been sleeping for different amounts of time finish at the same time, for example between 3% and 5% there are two workers that finished: they respectively performed a 1s-long and a 5s-long computation.</p><p>The last line of the output shows the shared resource <code class="language-plaintext highlighter-rouge">shared_list</code>: it contains the amount of time in seconds for which the computations lasted, one item per amount of time, in the order in which the processes have been completed. No value appears twice.</p><p>This example shows that the execution of the <code class="language-plaintext highlighter-rouge">worker.py</code> script has been parallelized on several CPU threads and that every process successfully accessed the shared resource, by reading and updating it.</p><h2 id="further-reading">Further reading</h2><ul><li><a href="https://docs.python.org/3/library/subprocess.html"><code class="language-plaintext highlighter-rouge">subprocess</code></a> (Python documentation)<li><a href="https://docs.python.org/3/library/multiprocessing.html"><code class="language-plaintext highlighter-rouge">multiprocessing</code></a> (Python documentation)<li><a href="https://stackabuse.com/parallel-processing-in-python/">Parallel processing in Python</a> (Frank Hofmann on stackabuse)<li><a href="https://pymotw.com/3/multiprocessing/index.html"><code class="language-plaintext highlighter-rouge">multiprocessing</code> – Manage processes like threads</a> (Doug Hellmann on Python Module of the Week)</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/python/'>Python</a>, <a href='/categories/concurrency/'>concurrency</a>, <a href='/categories/subprocess/'>subprocess</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/subprocess/" class="post-tag no-text-decoration" >subprocess</a> <a href="/tags/multiprocessing/" class="post-tag no-text-decoration" >multiprocessing</a> <a href="/tags/lock/" class="post-tag no-text-decoration" >lock</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Multiprocessing in Python with shared resources - Alexandra Zaharia&url=https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Multiprocessing in Python with shared resources - Alexandra Zaharia&u=https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Multiprocessing in Python with shared resources - Alexandra Zaharia&url=https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Multiprocessing in Python with shared resources - Alexandra Zaharia&u=https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/connect-bluetooth-headset-automatically-linux/">Connect a bluetooth headset automatically in Linux</a><li><a href="/posts/concurrency-crash-course-part-1/">Concurrency crash course. Part 1&#58; Terminology, usage and pitfalls</a><li><a href="/posts/my-2021-dev-retrospective/">My 2021 dev retrospective</a><li><a href="/posts/how-to-stop-a-python-thread-cleanly/">How to stop a Python thread cleanly</a><li><a href="/posts/how-to-return-a-result-from-a-python-thread/">How to return a result from a Python thread</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/run-python-script-as-subprocess-with-multiprocessing/"><div class="card-body"> <span class="timeago small" >Apr 17, 2019<i class="unloaded">2019-04-17T01:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Run a Python script as a subprocess with the multiprocessing module</h3><div class="text-muted small"><p> The problem Suppose you have a Python script worker.py performing some long computation. Also suppose you need to perform these computations several times for different input data. If all the comp...</p></div></div></a></div><div class="card"> <a href="/posts/kill-subprocess-and-its-children-on-timeout-python/"><div class="card-body"> <span class="timeago small" >Jul 5, 2021<i class="unloaded">2021-07-05T01:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kill a Python subprocess and its children when a timeout is reached</h3><div class="text-muted small"><p> Suppose a Python script needs to launch an external command. This can be done using the subprocess module in one of two ways: either use the “convenience” function subprocess.run() or use the...</p></div></div></a></div><div class="card"> <a href="/posts/function-timeout-in-python-multiprocessing/"><div class="card-body"> <span class="timeago small" >Feb 8, 2016<i class="unloaded">2016-02-08T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Function timeout in Python using the multiprocessing module</h3><div class="text-muted small"><p> The problem Sometimes you may want to impose a timeout on a Python function. Why would you want to do such a thing? Let’s say you’re computing something but you know there are some hopeless scenar...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/run-python-script-as-subprocess-with-multiprocessing/" class="btn btn-outline-primary" prompt="Older"><p>Run a Python script as a subprocess with the multiprocessing module</p></a> <a href="/posts/how-to-check-the-ssh-host-key-fingerprint/" class="btn btn-outline-primary" prompt="Newer"><p>How to check the SSH host key fingerprint</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://alexandra-zaharia.github.io/posts/multiprocessing-in-python-with-shared-resources/'; this.page.identifier = '/posts/multiprocessing-in-python-with-shared-resources/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://azc.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/alexandra-zaharia">Alexandra Zaharia</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Z7ZY7JRFQJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z7ZY7JRFQJ'); }); </script>
