<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Use cases for Python environment variables" /><meta name="author" content="Alexandra Zaharia" /><meta property="og:locale" content="en" /><meta name="description" content="Today’s post focuses on environment variables in Python. They are one of several possible mechanisms for setting various configuration parameters. We can:" /><meta property="og:description" content="Today’s post focuses on environment variables in Python. They are one of several possible mechanisms for setting various configuration parameters. We can:" /><link rel="canonical" href="https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" /><meta property="og:url" content="https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" /><meta property="og:site_name" content="Alexandra Zaharia" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-25T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Use cases for Python environment variables" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Alexandra Zaharia" /><meta name="google-site-verification" content="mlwABpnF22MCyeNCQoei9VdIPvqy_uV7b4v_vArTxXM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexandra Zaharia"},"dateModified":"2021-11-28T11:26:12+01:00","datePublished":"2021-11-25T00:00:00+01:00","description":"Today’s post focuses on environment variables in Python. They are one of several possible mechanisms for setting various configuration parameters. We can:","headline":"Use cases for Python environment variables","mainEntityOfPage":{"@type":"WebPage","@id":"https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/"},"url":"https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/"}</script><title>Use cases for Python environment variables | Alexandra Zaharia</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alexandra Zaharia"><meta name="application-name" content="Alexandra Zaharia"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/site/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Alexandra Zaharia</a></div><div class="site-subtitle font-italic">My dev blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/alexandra-zaharia" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/alexandra-zaharia-fr" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['contact','alexandra-zaharia.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Use cases for Python environment variables</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Use cases for Python environment variables</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexandra Zaharia </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 25, 2021, 12:00 AM +0100" >Nov 25, 2021<i class="unloaded">2021-11-25T00:00:00+01:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 28, 2021, 11:26 AM +0100" >Nov 28, 2021<i class="unloaded">2021-11-28T11:26:12+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1616 words">8 min read</span></div></div><div class="post-content"><p>Today’s post focuses on environment variables in Python. They are one of several possible mechanisms for setting various configuration parameters. We can:</p><ul><li>read environment variables (through <a href="https://docs.python.org/3/library/os.html"><code class="language-plaintext highlighter-rouge">os.environ</code></a> or <a href="https://pypi.org/project/python-dotenv/"><code class="language-plaintext highlighter-rouge">dotenv</code></a>) [the current post]<li>have the script accept command-line arguments (use <a href="https://docs.python.org/3/library/argparse.html"><code class="language-plaintext highlighter-rouge">argparse</code></a>)<li>load configuration settings from a file, such as:<ul><li>a JSON file (use <a href="https://docs.python.org/3/library/json.html"><code class="language-plaintext highlighter-rouge">json</code></a>)<li>a YAML file (use <a href="https://wiki.python.org/moin/YAML"><code class="language-plaintext highlighter-rouge">pyyaml</code></a>)<li>a XML file (use <a href="https://lxml.de/"><code class="language-plaintext highlighter-rouge">lxml</code></a>, <a href="https://docs.python.org/3/library/xml.etree.elementtree.html"><code class="language-plaintext highlighter-rouge">ElementTree</code></a> or <a href="https://docs.python.org/3/library/xml.dom.minidom.html"><code class="language-plaintext highlighter-rouge">minidom</code></a>)<li>an INI file (use <a href="https://docs.python.org/3/library/configparser.html"><code class="language-plaintext highlighter-rouge">configparser</code></a>) [check out <a href="/posts/python-configuration-and-dataclasses/">this post</a>]<li>your DIY file format (for which you will be rolling your own parser)</ul></ul><h2 id="what-is-the-best-solution">What is the best solution?</h2><p>The answer is… <em>it depends</em>.</p><p>There is no one-size-fits-all solution. It depends on what you’re trying to achieve and on how the current software architecture looks like. If you’re working on a command-line tool that must accommodate a plethora of options, chances are you’ll be using <code class="language-plaintext highlighter-rouge">argparse</code>. For other types of projects (such as a server or a client), a configuration file might be more practical. Yet in other situations you may also want to consider using environment variables.</p><p>We will be looking in more detail at three such use cases in this post, where we will see how environment variables can be a good choice.</p><p>But first, let’s get the next point out of the way:</p><h2 id="but-environment-variables-are-evil-right">But environment variables are evil, right?</h2><p>Well… <em>it depends</em>.</p><p>Indeed, using environment variables for non-sensitive information that you could just as well transmit via command-line arguments or via a configuration file is not ideal. Why? Because being <em>environment</em> variables, they actually live <em>outside</em> of the code base. Sure, you can access them based on their key (their name) and attach some meaning to them, but this is neither the most Pythonic, nor the most effective way, to do things (if this can be avoided).</p><p>Nevertheless, there are also legit cases where environment variables are preferable:</p><ul><li>when setting execution mode (e.g. debug or development mode vs production mode)<li>when they improve security practices<li>when they are the only way to get some values into a “black box” (more on that later)</ul><p>Before diving into the use cases, let us first briefly see how to access environment variables in Python.</p><h2 id="accessing-environment-variables-in-python">Accessing environment variables in Python</h2><p>Environment variables are read through <a href="https://docs.python.org/3/library/os.html"><code class="language-plaintext highlighter-rouge">os.environ</code></a>. Although they can also be modified or cleared, such changes are only effective in the current Python session (and for subprocesses started with <code class="language-plaintext highlighter-rouge">os.system()</code>, <code class="language-plaintext highlighter-rouge">popen()</code>, <code class="language-plaintext highlighter-rouge">fork()</code> and <code class="language-plaintext highlighter-rouge">execv()</code>). In other words, if you change an environment variable in a Python script, the change will not be reflected in the environment once that script exits.</p><h3 id="osenviron">os.environ</h3><p>In the most simple form, you can export an environment variable through the shell:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">foo</span><span class="o">=</span><span class="s1">'bar'</span>
</pre></table></code></div></div><p>Then you can read its value through <code class="language-plaintext highlighter-rouge">os.environ</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="n">os</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">foo</span><span class="sh">'</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="sh">'</span><span class="s">bar</span><span class="sh">'</span>
</pre></table></code></div></div><p>Note that, for non-existent keys, <code class="language-plaintext highlighter-rouge">os.environ.get()</code> returns <code class="language-plaintext highlighter-rouge">None</code>.</p><p>Also note that the values of <em>all</em> environment variables are strings. To address this, you may want to roll your own small environment parser. Mine looks like this:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span>


<span class="k">def</span> <span class="nf">parse_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nf">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>


<span class="k">def</span> <span class="nf">get_env_setting</span><span class="p">(</span><span class="n">setting</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">setting</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">return</span> <span class="nf">parse_string</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="n">setting</span><span class="p">])</span>
</pre></table></code></div></div><p>I use <code class="language-plaintext highlighter-rouge">get_env_setting()</code> to retrieve a value from <code class="language-plaintext highlighter-rouge">os.environ</code> (if the key exists) and I try to convert it to different data types:</p><ul><li>first, as a bool (this is because if I set boolean environment variables in Python, I store their <code class="language-plaintext highlighter-rouge">str()</code> representation, meaning <code class="language-plaintext highlighter-rouge">'True'</code> for <code class="language-plaintext highlighter-rouge">True</code> and <code class="language-plaintext highlighter-rouge">'False'</code> for <code class="language-plaintext highlighter-rouge">False</code>);<li>if this fails, the value is converted to an <code class="language-plaintext highlighter-rouge">int</code>;<li>if this fails as well, the value is converted to a <code class="language-plaintext highlighter-rouge">float</code>:<ul><li>if successful, <code class="language-plaintext highlighter-rouge">parse_string()</code> returns a <code class="language-plaintext highlighter-rouge">float</code>;<li>if not, it returns a <code class="language-plaintext highlighter-rouge">str</code>.</ul></ul><h3 id="dotenv">dotenv</h3><p>To set multiple environment variables, you could create a bash script and ensure you run it before starting the Python script that needs these environment variables. But there is something more effective than this: <a href="https://pypi.org/project/python-dotenv/"><code class="language-plaintext highlighter-rouge">dotenv</code></a> allows you to load environment variables from a <code class="language-plaintext highlighter-rouge">.env</code> file having the following format:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># Development settings</span>
<span class="nv">DOMAIN</span><span class="o">=</span>example.org
<span class="nv">ADMIN_EMAIL</span><span class="o">=</span>admin@<span class="k">${</span><span class="nv">DOMAIN</span><span class="k">}</span>
<span class="nv">ROOT_URL</span><span class="o">=</span><span class="k">${</span><span class="nv">DOMAIN</span><span class="k">}</span>/app
</pre></table></code></div></div><p>Notice the <code class="language-plaintext highlighter-rouge">.env</code> file understands UNIX expansion (e.g. <code class="language-plaintext highlighter-rouge">${DOMAIN}</code>).</p><p><a href="https://pypi.org/project/python-dotenv/"><code class="language-plaintext highlighter-rouge">dotenv</code></a> loads the environment variables from <code class="language-plaintext highlighter-rouge">.env</code> into the environment:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="nf">load_dotenv</span><span class="p">()</span>
</pre></table></code></div></div><p>Now the environment variables <code class="language-plaintext highlighter-rouge">DOMAIN</code>, <code class="language-plaintext highlighter-rouge">ADMIN_EMAIL</code> and <code class="language-plaintext highlighter-rouge">ROOT_URL</code> are accessible to the Python script and may be retrieved via <code class="language-plaintext highlighter-rouge">os.environ.get()</code> as shown above.</p><h2 id="use-case-setting-execution-mode">Use case: setting execution mode</h2><p>Here is a classic use case for environment variables. Suppose you don’t want to add an explicit <code class="language-plaintext highlighter-rouge">-d</code> / <code class="language-plaintext highlighter-rouge">--debug</code> flag for your app. Then you could just export an environment variable to do the trick:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">MY_APP_DEBUG</span><span class="o">=</span>1
</pre></table></code></div></div><p>The app would behave differently depending on the value of <code class="language-plaintext highlighter-rouge">MY_APP_DEBUG</code>.</p><p>Taking this idea one step further, you could use an environment variable <code class="language-plaintext highlighter-rouge">MY_APP_MODE</code> to choose between <code class="language-plaintext highlighter-rouge">development</code>, <code class="language-plaintext highlighter-rouge">staging</code> and <code class="language-plaintext highlighter-rouge">production</code> modes.</p><h2 id="use-case-securing-access-tokens">Use case: securing access tokens</h2><p>Many applications require access tokens: they can be API tokens, database passwords and so on. Storing such sensitive information inside the code base is just an accident waiting to happen, no matter how <em>sure</em> you are that you’re <em>never</em> going to commit that special extra line to version control.</p><p>Here’s where environment variables come in handy. You could add your secret tokens to the <code class="language-plaintext highlighter-rouge">.env</code> file and load it with <code class="language-plaintext highlighter-rouge">dotenv</code> as we’ve seen above. Of course, you’d need to make sure that your <code class="language-plaintext highlighter-rouge">.gitignore</code> or <code class="language-plaintext highlighter-rouge">.hgignore</code> contains the <code class="language-plaintext highlighter-rouge">.env</code> file.</p><p>In short, instead of:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1"># NOTE TO SELF: DO ***NOT*** COMMIT THIS TO VERSION CONTROL!
</span><span class="n">SECRET_TOKEN</span> <span class="o">=</span> <span class="sh">'</span><span class="s">56a682c4d000c676f543124b332a2921</span><span class="sh">'</span>
<span class="c1"># ...
</span><span class="nf">do_stuff_with</span><span class="p">(</span><span class="n">SECRET_TOKEN</span><span class="p">)</span>
</pre></table></code></div></div><p>prefer adding your <code class="language-plaintext highlighter-rouge">SECRET_TOKEN</code> to <code class="language-plaintext highlighter-rouge">.env</code>, adding <code class="language-plaintext highlighter-rouge">.env</code> to your version control’s ignore file, and finally:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">dotenv</span><span class="p">.</span><span class="nf">load_dotenv</span><span class="p">()</span>
<span class="c1"># ...
</span><span class="n">SECRET_TOKEN</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">SECRET_TOKEN</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">do_stuff_with</span><span class="p">(</span><span class="n">SECRET_TOKEN</span><span class="p">)</span>
</pre></table></code></div></div><h2 id="use-case-injecting-configuration-into-a-black-box">Use case: injecting configuration into a black box</h2><p>This final use case is something you’re not going to come across very often in internet discussions. It’s something I call a “black box”, meaning code that you have no control over: you didn’t write it, you cannot change it but you have to run it. Along these lines, remember how I wrote in a <a href="/posts/standalone-python-script-to-run-other-python-scripts/">previous post</a> about creating a Python script that runs user code from other Python scripts. That’s the kind of use case I am referring to.</p><p>OK, you may ask, <em>but why???</em> Why would you want to run code that you have no control over? Well, suppose you’re writing a testing framework that other people may use to write tests for… well, testing stuff. The tests are not relevant, only the part about <em>having to run them</em> is. There are two aspects at play here:</p><ul><li>the framework is a <strong>library</strong> that users import from in order to write their tests;<li>the framework is also a <strong>framework</strong>, meaning a master runner script that runs the user scripts.</ul><p>For the users’ sake, their only task should be to read and understand the framework’s well-documented API. They should <em>not</em> have to fiddle around with passing configuration options into their code. The configuration options for running their scripts through the framework may be sent through the command line and/or through configuration files.</p><p>What a user script typically does is to import abstractions from the framework and to use them for creating and executing tests. For example:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1"># user_script.py
</span><span class="kn">from</span> <span class="n">fancy_framework</span> <span class="kn">import</span> <span class="n">Test</span><span class="p">,</span> <span class="n">PhaseResult</span>

<span class="k">def</span> <span class="nf">a_test_phase</span><span class="p">(</span><span class="n">api</span><span class="p">):</span>
    <span class="nf">do_stuff</span><span class="p">()</span>  <span class="c1"># assume this exists
</span>
<span class="k">def</span> <span class="nf">another_test_phase</span><span class="p">(</span><span class="n">api</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">check_stuff</span><span class="p">():</span>  <span class="c1"># assume this exists
</span>        <span class="k">return</span> <span class="n">PhaseResult</span><span class="p">.</span><span class="n">FAIL</span>

<span class="n">my_test</span> <span class="o">=</span> <span class="nc">Test</span><span class="p">(</span><span class="n">a_test_phase</span><span class="p">,</span> <span class="n">another_test_phase</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sh">'</span><span class="s">My Test</span><span class="sh">'</span><span class="p">)</span>
<span class="n">my_test</span><span class="p">.</span><span class="nf">execute</span><span class="p">()</span>
</pre></table></code></div></div><p>Let us suppose that if the user script is ran with verbosity off (default), it only shows the test result:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>$ fancy_framework user_script.py

====================== Running test My Test (attempt #1) =======================

Finished running test My Test ......................................... [ FAIL ]
________________________________________________________________________________

$
</pre></table></code></div></div><p>When the script is ran with the <code class="language-plaintext highlighter-rouge">--verbose</code> flag, it displays phase results as well:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>$ fancy_framework --verbose user_script.py

====================== Running test My Test (attempt #1) =======================

Phase a_test_phase .................................................... [ PASS ]
Phase another_test_phase .............................................. [ FAIL ]

Finished running test My Test ......................................... [ FAIL ]
________________________________________________________________________________

$
</pre></table></code></div></div><p>Now remember that what the <code class="language-plaintext highlighter-rouge">fancy_framework</code> does among other things is to simply run the provided <code class="language-plaintext highlighter-rouge">user_script.py</code>. How should a <code class="language-plaintext highlighter-rouge">fancy_framework.Test</code> object know whether verbosity is on when its <code class="language-plaintext highlighter-rouge">execute()</code> method is called? Here is where environment variables step in to save the day:</p><ul><li>The <code class="language-plaintext highlighter-rouge">fancy_framework</code> exports an environment variable <code class="language-plaintext highlighter-rouge">FANCY_FRAMEWORK_VERBOSITY</code> according to the user’s choice (whether the <code class="language-plaintext highlighter-rouge">--verbose</code> flag was used).<li>When a <code class="language-plaintext highlighter-rouge">Test</code> object is initialized, it reads the value of <code class="language-plaintext highlighter-rouge">FANCY_FRAMEWORK_VERBOSITY</code> from <code class="language-plaintext highlighter-rouge">os.environ</code> and stores it in an instance variable <code class="language-plaintext highlighter-rouge">self._verbose</code>.<li>When the <code class="language-plaintext highlighter-rouge">execute()</code> method of the <code class="language-plaintext highlighter-rouge">Test</code> instance is called, details are printed to stdout only if <code class="language-plaintext highlighter-rouge">self._verbose</code> is true.</ul><p>Here is a simplified version (using the <code class="language-plaintext highlighter-rouge">get_env_setting()</code> helper we’ve seen above):</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">phases</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_phases</span> <span class="o">=</span> <span class="nf">create_phases</span><span class="p">(</span><span class="n">phases</span><span class="p">)</span>  <span class="c1"># assume this exists
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="nf">get_env_settings</span><span class="p">(</span><span class="sh">'</span><span class="s">FANCY_FRAMEWORK_VERBOSITY</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="nf">print_running_test</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>  <span class="c1"># assume this exists
</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">_phases</span><span class="p">:</span>
            <span class="n">phase</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_verbose</span><span class="p">:</span>
                <span class="nf">print_phase_outcome</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>  <span class="c1"># assume this exists
</span>
        <span class="nf">print_test_outcome</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>  <span class="c1"># assume this exists
</span></pre></table></code></div></div><p>Isn’t that neat? In this use case we’ve seen how environment variables can be used to inject configuration into a black-box system.</p><p>Check out <a href="/posts/python-configuration-and-dataclasses/">this article</a> for a discussion of passing configuration options in Python in such a way as to only use <em>identifiers</em> instead of strings for the configuration keys.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/python/'>Python</a>, <a href='/categories/configuration/'>configuration</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/environment/" class="post-tag no-text-decoration" >environment</a> <a href="/tags/software-design/" class="post-tag no-text-decoration" >software design</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Use cases for Python environment variables - Alexandra Zaharia&url=https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Use cases for Python environment variables - Alexandra Zaharia&u=https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Use cases for Python environment variables - Alexandra Zaharia&url=https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Use cases for Python environment variables - Alexandra Zaharia&u=https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/connect-bluetooth-headset-automatically-linux/">Connect a bluetooth headset automatically in Linux</a><li><a href="/posts/concurrency-crash-course-part-1/">Concurrency crash course. Part 1&#58; Terminology, usage and pitfalls</a><li><a href="/posts/my-2021-dev-retrospective/">My 2021 dev retrospective</a><li><a href="/posts/how-to-stop-a-python-thread-cleanly/">How to stop a Python thread cleanly</a><li><a href="/posts/how-to-return-a-result-from-a-python-thread/">How to return a result from a Python thread</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/python-configuration-and-dataclasses/"><div class="card-body"> <span class="timeago small" >Nov 5, 2021<i class="unloaded">2021-11-05T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Python configuration and data classes</h3><div class="text-muted small"><p> I stumbled upon an interesting article in which the author describes best practices for working with configuration files in Python. One of the points he makes is that configuration settings should ...</p></div></div></a></div><div class="card"> <a href="/posts/concurrency-crash-course-part-2/"><div class="card-body"> <span class="timeago small" >Jan 9, 2022<i class="unloaded">2022-01-09T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Concurrency crash course. Part 2&#58; Threads and the Python GIL</h3><div class="text-muted small"><p> This is a multi-part post: Part 1 establishes terminology (tasks, threads and processes and how they relate to concurrency and parallelism) and gives an overview of challenges faced in concurren...</p></div></div></a></div><div class="card"> <a href="/posts/function-timeout-in-python-signal/"><div class="card-body"> <span class="timeago small" >Feb 5, 2016<i class="unloaded">2016-02-05T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Function timeout in Python using the signal module</h3><div class="text-muted small"><p> The problem Sometimes you may want to impose a timeout on a Python function. Why would you want to do such a thing? Let’s say you’re computing something but you know there are some hopeless scenar...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/overloaded-insertion-operator-in-cpp-exceptions/" class="btn btn-outline-primary" prompt="Older"><p>The overloaded insertion operator in C++ exceptions</p></a> <a href="/posts/set-up-automatic-ssh-login-on-linux/" class="btn btn-outline-primary" prompt="Newer"><p>Set up an automatic SSH login on Linux</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://alexandra-zaharia.github.io/posts/use-cases-for-python-environment-variables/'; this.page.identifier = '/posts/use-cases-for-python-environment-variables/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://azc.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/alexandra-zaharia">Alexandra Zaharia</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Z7ZY7JRFQJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z7ZY7JRFQJ'); }); </script>
