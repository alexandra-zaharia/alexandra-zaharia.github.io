<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="(Anonymous) unions in C" /><meta name="author" content="Alexandra Zaharia" /><meta property="og:locale" content="en" /><meta name="description" content="The first time I had to explain to students why a C union may sometimes come in handy, I came up with this example. As my students had only been exposed to C for about 15 hours, I needed to refrain from talking about standard use cases involving low-level operations where unions are very useful." /><meta property="og:description" content="The first time I had to explain to students why a C union may sometimes come in handy, I came up with this example. As my students had only been exposed to C for about 15 hours, I needed to refrain from talking about standard use cases involving low-level operations where unions are very useful." /><link rel="canonical" href="https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" /><meta property="og:url" content="https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" /><meta property="og:site_name" content="Alexandra Zaharia" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-12-17T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="(Anonymous) unions in C" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Alexandra Zaharia" /><meta name="google-site-verification" content="mlwABpnF22MCyeNCQoei9VdIPvqy_uV7b4v_vArTxXM" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexandra Zaharia"},"dateModified":"2021-11-27T19:22:50+01:00","datePublished":"2017-12-17T00:00:00+01:00","description":"The first time I had to explain to students why a C union may sometimes come in handy, I came up with this example. As my students had only been exposed to C for about 15 hours, I needed to refrain from talking about standard use cases involving low-level operations where unions are very useful.","headline":"(Anonymous) unions in C","mainEntityOfPage":{"@type":"WebPage","@id":"https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/"},"url":"https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/"}</script><title>(Anonymous) unions in C | Alexandra Zaharia</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alexandra Zaharia"><meta name="application-name" content="Alexandra Zaharia"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/site/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">Alexandra Zaharia</a>
</div>
<div class="site-subtitle font-italic">My dev blog</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
<li class="nav-item"> <a href="/resume/" class="nav-link"> <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/alexandra-zaharia" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/alexandra-zaharia-fr" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href%20=%20'mailto:'%20+%20['contact','alexandra-zaharia.org'].join('@')" aria-label="email"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss"> <i class="fas fa-rss"></i> </a>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>(Anonymous) unions in C</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>(Anonymous) unions in C</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="semi-bold"> Alexandra Zaharia </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 17, 2017, 12:00 AM +0100">Dec 17, 2017<i class="unloaded">2017-12-17T00:00:00+01:00</i> </span>
</div>
<div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 27, 2021, 7:22 PM +0100">Nov 27, 2021<i class="unloaded">2021-11-27T19:22:50+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1203 words">6 min read</span>
</div>
</div>
<div class="post-content">
<p>The first time I had to explain to students why a C <code class="language-plaintext highlighter-rouge">union</code> may sometimes come in handy, I came up with this example. As my students had only been exposed to C for about 15 hours, I needed to refrain from talking about standard use cases involving low-level operations where unions are very useful.</p>
<h2 id="the-problem">The problem</h2>
<p>Suppose we have 2D segments defined by their endpoints, like this:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Point2D</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Point2D</span> <span class="n">start</span><span class="p">;</span>
    <span class="n">Point2D</span> <span class="n">end</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Segment</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>Now, suppose we are required to write a function that will project a given segment on the horizontal (X) axis, and another one that will project the segment on the vertical (Y) axis. In most cases, the projection of a segment on either of the axes is another segment.</p>
<p><img data-proofer-ignore data-src="/assets/img/posts/union_projection_1.png" alt="the projection is a segment" width="200" class="right"> For example, in the figure at the right we have a segment with endpoints (1, 1) and (2, 2). (It will be referred to as “the red segment” later on.) Its projections on the X and Y axes will be:</p>
<ul>
<li>The segment with endpoints (1, 0) and (2, 0) on the horizontal axis (in pink);</li>
<li>The segment with endpoints (0, 1) and (0, 2) on the vertical axis (in purple).</li>
</ul>
<p>However, there are two special edge cases:</p>
<ul>
<li>If the segment is vertical (its <em>x</em> coordinates for both endpoints are the same), then its projection on the horizontal (X) axis is a point.</li>
<li>If the segment is horizontal (its <em>y</em> coordinates for both endpoints are the same), then its projection on the vertical (Y) axis is a point.</li>
</ul>
<p><img data-proofer-ignore data-src="/assets/img/posts/union_projection_2.png" alt="the projection is a point" width="200" class="right"></p>
<p>For example, in the figure at the right we have a segment with endpoints (1, 2) and (2, 2). (This segment will be referred to as “the blue segment” later on.) Its projection on the horizontal axis is another segment, but its projection on the vertical axis is the point with coordinates (0, 2).</p>
<p>Therefore, the result of either projection operation in terms of the data structures defined in the code snippet above can be either a <code class="language-plaintext highlighter-rouge">Segment</code> or a <code class="language-plaintext highlighter-rouge">Point2D</code>. And, as it so happens, one cannot have a function return different result types in a strongly typed language such as C.</p>
<h2 id="the-solution-unions">The solution: unions</h2>
<p>Enter <strong>unions</strong>. They allow you to store different data types in the same memory space, but not at the same time. Like a <code class="language-plaintext highlighter-rouge">struct</code>, a union has members, but only one of them can store information at any given time. Why is this interesting, you ask? Here’s why: a <code class="language-plaintext highlighter-rouge">union</code> has the size of its largest member. This is very important when aiming to reduce the memory footprint of an application.</p>
<p>Here is a first take for a <code class="language-plaintext highlighter-rouge">union</code> that stores the result of a segment projection operation:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="n">Segment</span> <span class="n">segment</span><span class="p">;</span>
    <span class="n">Point2D</span> <span class="n">point</span><span class="p">;</span>
<span class="p">}</span> <span class="n">_Projection</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>Using the <code class="language-plaintext highlighter-rouge">_Projection</code> union above, when we project the red segment on the X and Y axes, we store the resulting segment in the <code class="language-plaintext highlighter-rouge">segment</code> member of the union. Conversely, when we project the blue segment on the X and Y axes, we store the resulting point in the <code class="language-plaintext highlighter-rouge">point</code> member of the union.</p>
<p>That’s great, but how do we know in which member of the union our valuable information is being stored? We need some sort of hint to figure out if a given <code class="language-plaintext highlighter-rouge">_Projection</code> variable contains a segment or a point. This hint commonly goes by the name of <em>flag</em> and requires a structure of its own to live in. We cannot simply add the flag to the <code class="language-plaintext highlighter-rouge">_Projection</code> union directly since this would mean that such a union can only store one of three possible values: a segment, a point or a flag. For this reason we wrap the whole <code class="language-plaintext highlighter-rouge">_Projection</code> union into a <code class="language-plaintext highlighter-rouge">struct</code>, as follows:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">_Projection</span> <span class="n">proj</span><span class="p">;</span>
    <span class="n">bool</span> <span class="n">is_segment</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Projection</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>(Don’t forget to <code class="language-plaintext highlighter-rouge">#include &lt;stdbool.h&gt;</code> for the <code class="language-plaintext highlighter-rouge">bool</code> type.)</p>
<p>So how does this thing work? We could write something like the following:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="n">Projection</span> <span class="n">p</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">is_segment</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">proj</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">proj</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="even-better-anonymous-unions">Even better: anonymous unions</h2>
<p>I think you will agree that the access to <code class="language-plaintext highlighter-rouge">proj</code> is both tiring and ugly. We can avoid it if we nest the union <em>directly</em> inside the struct, without giving it a name. This is called an <strong>anonymous union</strong>. The catch is that anonymous unions are only available starting with <a href="https://en.wikipedia.org/wiki/C11_(C_standard_revision)">C11</a>. So let’s rewrite the data structure:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">union</span> <span class="p">{</span>
	    <span class="n">Point2D</span> <span class="n">point</span><span class="p">;</span>
	    <span class="n">Segment</span> <span class="n">segment</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">bool</span> <span class="n">is_segment</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Projection</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>It is now much easier to access, say, the <code class="language-plaintext highlighter-rouge">point</code> member:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre><span class="n">Projection</span> <span class="n">p</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">is_segment</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="practical-usage">Practical usage</h2>
<p>Great, so how do we use this? Let’s look at one of the two projection functions, for instance the one that projects a given segment on the vertical (Y) axis. We could write it as follows:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="cm">/*
 * Projects 'segment' on the vertical (Y) axis and returns the projection
 * result: a Point2D if 'segment' is horizontal, or another Segment otherwise.
 */</span>
<span class="n">Projection</span> <span class="nf">vertical_projection</span><span class="p">(</span><span class="n">Segment</span> <span class="n">segment</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Projection</span> <span class="n">result</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">result</span><span class="p">.</span><span class="n">is_segment</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
       <span class="n">result</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
       <span class="n">result</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">result</span><span class="p">.</span><span class="n">is_segment</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="testing-the-solution">Testing the solution</h2>
<p>Let’s test the <code class="language-plaintext highlighter-rouge">vertical_projection()</code> function on the red and blue segments above.</p>
<p>The first thing to do is to define two general functions that will test whether a <code class="language-plaintext highlighter-rouge">Projection</code> respectively contains the specified <code class="language-plaintext highlighter-rouge">Segment</code> or <code class="language-plaintext highlighter-rouge">Point2D</code>. These functions will involve assertions, so we will need to <code class="language-plaintext highlighter-rouge">#include &lt;assert.h&gt;</code>. If an assertion fails, the program execution is aborted.</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="rouge-code"><pre><span class="cm">/* Checks whether the Projection contains the specified Point2D. */</span>
<span class="kt">void</span> <span class="nf">assert_projection_is_point</span><span class="p">(</span><span class="n">Projection</span> <span class="n">result</span><span class="p">,</span> <span class="n">Point2D</span> <span class="n">point</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">is_segment</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Checks whether the Projection contains the specified Segment. */</span>
<span class="kt">void</span> <span class="nf">assert_projection_is_segment</span><span class="p">(</span><span class="n">Projection</span> <span class="n">result</span><span class="p">,</span> <span class="n">Segment</span> <span class="n">segment</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">is_segment</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">x</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">segment</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">x</span>
        <span class="o">&amp;&amp;</span> <span class="n">result</span><span class="p">.</span><span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">segment</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>These two general functions may now be used to test the specific examples we’ve seen above.</p>
<p>The red segment must have the segment with endpoints (0, 1) and (0, 2) as its projection on the vertical axis (in purple in the figure):</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre>
<span class="n">Segment</span> <span class="n">red_segment</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}};</span>
<span class="n">Segment</span> <span class="n">red_v_proj</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">}};</span>

<span class="n">assert_is_segment</span><span class="p">(</span><span class="n">vertical_projection</span><span class="p">(</span><span class="n">red_segment</span><span class="p">),</span> <span class="n">red_v_proj</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<p>The blue segment must have the point with coordinates (0, 2) as its projection on the vertical axis:</p>
<div class="language-c highlighter-rouge">
<div class="code-header"> <span text-data=" C "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button>
</div>
<div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre>
<span class="n">Segment</span> <span class="n">blue_segment</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}};</span>
<span class="n">Point2D</span> <span class="n">blue_v_proj</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>

<span class="n">assert_is_point</span><span class="p">(</span><span class="n">vertical_projection</span><span class="p">(</span><span class="n">blue_segment</span><span class="p">),</span> <span class="n">blue_v_proj</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div>
</div>
<h2 id="notes">Notes</h2>
<ul>
<li>These examples do not use pointers as it was beyond the scope of the class.</li>
<li>No student fell asleep during the class but they were all eerily quiet. I think they might find nested structures disturbing.</li>
<li>The full implementation is available on <a href="https://github.com/alexandra-zaharia/c-playground/tree/master/anonymous_union">GitHub</a>.</li>
</ul>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/c-c/">C/C++</a>, <a href="/categories/data-types/">data types</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c-c/" class="post-tag no-text-decoration">c/c++</a> <a href="/tags/union/" class="post-tag no-text-decoration">union</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=(Anonymous)%20unions%20in%20C%20-%20Alexandra%20Zaharia&amp;url=https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=(Anonymous)%20unions%20in%20C%20-%20Alexandra%20Zaharia&amp;u=https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=(Anonymous)%20unions%20in%20C%20-%20Alexandra%20Zaharia&amp;url=https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=(Anonymous)%20unions%20in%20C%20-%20Alexandra%20Zaharia&amp;u=https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
<div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2">
<li><a href="/posts/connect-bluetooth-headset-automatically-linux/">Connect a bluetooth headset automatically in Linux</a></li>
<li><a href="/posts/concurrency-crash-course-part-1/">Concurrency crash course. Part 1: Terminology, usage and pitfalls</a></li>
<li><a href="/posts/my-2021-dev-retrospective/">My 2021 dev retrospective</a></li>
<li><a href="/posts/how-to-stop-a-python-thread-cleanly/">How to stop a Python thread cleanly</a></li>
<li><a href="/posts/how-to-return-a-result-from-a-python-thread/">How to return a result from a Python thread</a></li>
</ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav>
</div>
</div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/bitwise-nuggets-xor-swap/"><div class="card-body"> <span class="timeago small">Nov 2, 2021<i class="unloaded">2021-11-02T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bitwise nuggets: XOR swap</h3>
<div class="text-muted small"><p> XOR swap is a kind of in-place swap that only uses XOR operations. No temporary variable nor addition/subtraction operation is needed. However, it only works for integers. Reminder: XOR (short for...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/implementing-a-vector-in-c/"><div class="card-body"> <span class="timeago small">Dec 21, 2017<i class="unloaded">2017-12-21T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Implementing a vector in C</h3>
<div class="text-muted small"><p> Suppose we need a generic vector data structure in C, where by generic we mean it can handle any type of data. A vector uses an underlying array, therefore it supports index-based access to its ele...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/how-to-read-safely-from-stdin-in-c/"><div class="card-body"> <span class="timeago small">Dec 11, 2018<i class="unloaded">2018-12-11T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to read safely from stdin in C</h3>
<div class="text-muted small"><p> Ah, C and strings. <img class="emoji" title=":confounded:" alt=":confounded:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f616.png" height="20" width="20"> When reading from stdin, we can use fgets(str, n, stdin) to read at most n - 1 characters into a char array pointed to by str. We can also create a utility function...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/summing-a-column-with-awk/" class="btn btn-outline-primary" prompt="Older"><p>Summing a column with awk</p></a> <a href="/posts/implementing-a-vector-in-c/" class="btn btn-outline-primary" prompt="Newer"><p>Implementing a vector in C</p></a>
</div>
<div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div>
<script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://alexandra-zaharia.github.io/posts/anonymous-unions-in-c/'; this.page.identifier = '/posts/anonymous-unions-in-c/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://azc.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script>
</div></div></div>
<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/alexandra-zaharia">Alexandra Zaharia</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/c-c/">c/c++</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/binary/">binary</a> <a class="post-tag" href="/tags/bluetooth/">bluetooth</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/mercurial/">mercurial</a> <a class="post-tag" href="/tags/thread/">thread</a> <a class="post-tag" href="/tags/version-control/">version control</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-Z7ZY7JRFQJ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-Z7ZY7JRFQJ'); }); </script>
